
<!--<meta http-equiv="refresh" content="1" />-->
<head>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        var app = {
            "name": "TCP Graphs",
            "progress": 80
        };
    </script>
</head>

<body>
    <h1>input</h1>
    <div><textarea id="input" style="width:400px; height:100px;" onkeyup="refresh();"></textarea></div>

    <h1>graph</h1>

    <div id="tcp_graph" style="width: 800; height: 400px;"></div>

    <h1>Settings</h1>

        <ul id="fields" style="width: 400px; heaght: 100px; list-style: outside none;">
            <li>TEST</li>
        </ul>
    <!--<div id="summary" style="width: 400; height: 100px;"></div>-->
</body>

<script>


function make_tag(tagname, text) {
    return "<" + tagname + ">" + text + "</" + tagname + ">";
}

function pre(text) {
    return make_tag(pre, text)
}

function print(name, obj) {
    document.getElementById('summary').innerHTML = "<br><strong>" + name + "<pre>" + JSON.stringify(obj, null, 2) + "</pre>";
}

function parse_csv(stringrep) {
    lines = stringrep.split("\n")
    headers = lines[0].split(',')
    console.log("headers=" + headers + " headers.length=" + headers.length)

    lists = {};


    for (var i = 0; i != headers.length; ++i) {
        headers[i] = headers[i].trim()
        lists[headers[i]] = []
    }

    for (var li = 1; li != lines.length; ++li) {
        var fields = lines[li].split(',');
        if (fields.length != headers.length) {
            break
        }
        //console.log("fields=" + fields + " fields.length=" + fields.length)
        for (var fi = 0; fi != headers.length; ++fi) {
            lists[headers[fi]].push(fields[fi])
        }
    }

    return lists
}

document.getElementById('input').value = "speed,rtt,cwnd\n111,11,1\n222,22,2\n333,33,3"


function refresh() {
    lists = parse_csv(document.getElementById('input').value)
    //print("After parsing:", lists)

    var ul = document.getElementById("fields");
    ul.innerHTML = ""
    for (var field in lists) {
        ul.innerHTML += '<li><input type="checkbox" id="' + field + '" onclick="refresh_graph()" >&nbsp' + field + '</input></li>';
    }

    refresh_graph()
}

function refresh_graph() {
    Plotly.newPlot('tcp_graph', get_graphs(lists));
}


function get_graphs(lists) {
    var result = [];
    for (var field in lists) {
        if (document.getElementById(field).checked) {
            result.push({
                name: field,
                y: lists[field],
                type: 'scatter'
            });
            }
    }
    console.log("result: " + JSON.stringify(result, null, 2));
    return result;
}


refresh();


</script>
